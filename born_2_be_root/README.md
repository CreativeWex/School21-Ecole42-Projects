# Мой путь по Born2beRoot

1. [Установка дебиана](https://youtu.be/13YBlD0SOJo)

2. [Основная часть](https://baigal.medium.com/born2beroot-e6e26dfb50ac)

# Теоретическая часть
## Что такое виртуальная машина и с чем ее едят

***Виртуальная машина (ВМ)*** - эмуляция машины, она имеет ЦП, память, диски для хранения файлов. Виртуализция (процесс работы виртуальной машины) - процесс создания программной версии машины, ресурсы на которую выделяются из физической машины, на которой она запущена.

Используются для:
- работы с приложениями в облаке;
- тестирования;
- резервного копирования;
- эмулирования.

Сокращают размер физической инфраструктуры, обеспечивают гибкость и скорость.
<br>
<br>

## Отличия Debian и CentOS
***Debian*** - дистрибутив Linux (использует ядро, включает библеотеки, утилиты (вспомогатльные программы в составе ПО для работы с ОС), интерфейс), ОС для серверов и рабочих станций. Имеет хранилище пакетов - готовых к использованию программ и библеотек.

Debian, в отличие от CentOS разрабатывается волонтерами. В разработке CentOS косвенно принимает участие компания Red Hat Enterprice Linux, на основе исходников которой он основан, соответственно, CentOS более стабильный и наежный.

У Debian много как официальных, так и сторонних пакетов, в качестве менеджера которых, используется APT. В CentOS пакетов значительно меньше.

Debian получает обновления раз в два года, включая обновления безопасности и исправление ошибок, но сами обновления нестабильны. у CentOS нет графика обновлений, однако сами обновления стабильны и получают поддержку на долгий срок.

Отличия также присутствуют в интерфейсе, установке обновлений, менеджере пакетов и др.

***Выбирать Debian*** стоит из-за ряда преимуществ:
- простота, ОС ориентирована на новичков;
- больше пакетов и расширений;
- большое сообщество, много документации и форумов;
- на нем основаны популярные дистрибутивы (Ubuntu, Linux Mint)
- поддержка архитектуры;
<br>
<br>

## Базовые понятия
***APT (Advanced Packaging Tool)***  - ПО для установки, обновления и удаления программ, автоматически устанавливает и настраивает программы для Unix-подобных систем, предоставляет другим программам работу с пакетами.

***Aptitude*** - оболочка для APT для работы в текстовом и командном режимах.

***AppArmor*** - программный инструменты защиты, основанный на принудительном контроле доступа (профилях), которые определяют, к каким системным реурсам и к каким привиллегиям может доступ то или иное приложение.

 ***UFW (Uncomplecated Firewall)*** - утилита для конфигурации сетевого трафика через командую строку. Нужна для фильтрции и защиты данных от несанкционированного доступа.

***SSH(Secure Shell)*** - протокол удаленного администрирования для управления ОС и туннелирования TCP-соединения (Transport Control Protocol - один из основных протоколов передачи данных). Сжимает данные для шифрования и передачи, защищает канал.

Принцип работы основан на SSH-сервере и SSH-клиенте. SSH-сервер принимает соединение от машины пользователя и производит аутентификацию по ip/публичному ключу/зашифрованному паролю клиента.

***LVM (Logical Volume Manager / Менеджер логических томов)*** - подсистема Linux для разбиения разных областей жесткого диска и/или области с разных жестких дисков как логический том. 

Преимущества: одну группу логических томов можно создавать поверх любого количества физических разделов, размер логических томов можно легко менять прямо во время работы, LVM поддерживает механизм снапшотов, копирование разделов «на лету».

***sudo*** - программа для сис. администрирования и делегирования ресурсов пользователя с делегированием ресурсов пользователя. Предоставляет root права, либо действовать от других пользователей.

***Cron*** - демон (daemon - программа на Unix системах, запускаемая системой для работы в фоновом режиме без взаимодействия с пользователем), который используется для периодического выполнения заданий в определенное время.
<br>
<br>

# Mandatory part
## Simple setup
- убеждаемся, файрвол работает
`sudo ufw status`
-  ssh работает
`systemctl status ssh`

## User

- посмотреть всех пользователей
`sudo cut -d: -f1 /etc/passwd`

- посмотреть в каких группах состоит пользователь
`id -Gn <user>`
- создать пользователя с папкой / без папки (С ПАРОЛЕМ )
`sudo adduser <user>` / `sudo useradd <user>`

Правила по заполнению паролей `nano /etc/login.defs`

Конфиг правила паролей `nano /etc/pam.d/common-password`

## Groups
- создать группу `groupadd <you_group>`
- посмотреть группы `getent group`
- добаваить пользователя в группу `usermod -aG <you_group> <you_user>`
- удалить пользователя из группы `gpasswd -d <you_user> <you_group>`

## Hostname and partisions
- смена имени хоста
`nano /etc/hosts` и `nano /etc/hostname`
- Партиции `lsblk`
- инфа про лвм

## Sudo

- проверка наличия пакетов `sudo apt install sudo`
- лог судо `/var/log/sudo/`

## UFW

- проверка, что работает `sudo ufw status numbered`
- добавить порт `sudo ufw allow 8080`
- удалить порт `sudo ufw delete`

## SSH
- ssh работает `systemctl status ssh`
- ssh определение
- проверка что порт 4242 `nano /etc/ssh/sshd_config`
- подключиться через ssh к машине `ssh user@localhost -p 4242`

## Script Monitoring
Проходим по пути `cd /usr/local/bin/`

- Скрипт `touch monitoring.sh`
- Определение Cron
- Правило для скрипта без пароля `sudo visudo`
- Открытие крон таба для отложенного запуска скрипта `sudo crontab -u root -e`

### Скрипт на 10 минут

``sudo crontab -u root -e``

### Скрипт на 30 секунд

``#* * * * * /usr/local/bin/monitoring.sh``

``#* * * * * ( sleep 30 ; /usr/local/bin/monitoring.sh )``

### Политика паролей
Конфиг `nano /etc/pam.d/common-password`

Дописываем строку следующим образом:
`password requisite pam_pwquality.so minlen=10 ucredit=-1 lcredit=-1
dcredit=-1 maxrepeat=3 retry=3`

`usercheck=1 enforce_for_root` правила для root

<br>
<br>

# Script

Awk - сканирует входной файл в поисках шаблонов

1) [Architecture] `wall` - пишет сообщение, `uname -a` - выводит информацию  системе, `wc -l` - выводит все строки(количество)

2,3) [CPU physical] `cat /proc/cpuinfo` выводит всю информацию о всех процессорах, `grep` - ищет первое вхождение, затем печатает на экран, `wc -l` - выводит количество строк

4) [Memory Usage] `free -m` - отображает количество свободной и использованной памяти(Гб), `NR==2` - номер текущей записи в общем входном потоке
5) [Disk usage] `df -h ` - инфа по использованию диска в разрядности 1024. `NF` - число полей в текущем инпуте
6) [CPU Load] `top -bn1` - отображает процессы linux (b передает output из top в программы/файл работает до предела итераций n)
7) [Last boot] `who` - показывает залогиненых `-b` - показывает последний бут
8) [LVM Use] 
9) [Connection TCP] - `netstat` - отображает все, что связано с соединениями `-a` - все сокеты `-n` - число портов
10) [User log] - `cut` выводит выбранные части строк, `-d` - задает разделитель, `-f` = СПИСОК (выводит только столбцы, пперечисленные в списке), `sort` - сортирует строки `-u` строки не повторяются(уникальные)
11) [Network IP] `hostname` - имя хоста, `-I` - все сетевые адреса хоста




